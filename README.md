# AI Agents - Kaggle Capstone Project

A Google ADK (Agent Development Kit) project for building and deploying AI agents on Google Cloud Vertex AI Agent Engines.

## üìã Project Overview

This project demonstrates how to:
- Build AI agents using Google ADK
- Deploy agents to Google Cloud Vertex AI Agent Engines
- Query deployed agents via REST API
- Manage agent sessions and interactions

### Features

- **Weather Assistant Agent**: A conversational AI agent that provides weather information for cities
- **Tool Integration**: Demonstrates how agents can use tools (e.g., `get_weather` function)
- **Cloud Deployment**: Deploy agents to Google Cloud for production use
- **Session Management**: Create and manage sessions for agent interactions

## üèóÔ∏è Project Structure

```
Day5/
‚îú‚îÄ‚îÄ sample_agent/
‚îÇ   ‚îú‚îÄ‚îÄ agent.py              # Main agent definition
‚îÇ   ‚îú‚îÄ‚îÄ retrieveAgent.py      # Script to query deployed agent
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt      # Python dependencies
‚îÇ   ‚îú‚îÄ‚îÄ .env                  # Environment variables (not in git)
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore           # Protects sensitive files
‚îÇ   ‚îî‚îÄ‚îÄ *.md                 # Documentation files
‚îú‚îÄ‚îÄ .gitignore               # Root-level gitignore
‚îî‚îÄ‚îÄ README.md                # This file
```

## üöÄ Quick Start

### Prerequisites

1. **Google Cloud Account**
   - Project: `aiagent-capstoneproject`
   - Region: `us-central1`
   - Service account with required permissions

2. **Python 3.8+**
   - Anaconda or Python installed

3. **Google Cloud SDK**
   - `gcloud` CLI installed and authenticated

4. **Google ADK**
   - Installed via `pip install google-adk`

### Setup Steps

#### 1. Clone the Repository

```powershell
git clone https://github.com/nareshsaladi2024/AIAgents-Kaggle-Capstone.git
cd AIAgents-Kaggle-Capstone
```

#### 2. Create Virtual Environment

```powershell
# Create virtual environment
python -m venv .venv

# Activate virtual environment
.venv\Scripts\Activate.ps1  # Windows PowerShell
# or
source .venv/bin/activate   # Linux/Mac
```

#### 3. Install Dependencies

```powershell
cd sample_agent
pip install -r requirements.txt
```

#### 4. Configure Environment Variables

Create a `.env` file in `sample_agent/` directory:

```env
GOOGLE_CLOUD_PROJECT=aiagent-capstoneproject
GOOGLE_CLOUD_LOCATION=us-central1
DEPLOYED_REGION=us-central1
```

**Important**: Do NOT include `GOOGLE_APPLICATION_CREDENTIALS` in `.env` file (it's reserved for deployment).

#### 5. Set Up Google Cloud Authentication

**Option A: Service Account Key (Recommended for local development)**

1. Download service account key from Google Cloud Console
2. Save it in `sample_agent/` directory
3. Set environment variable in PowerShell:

```powershell
$env:GOOGLE_APPLICATION_CREDENTIALS = "path\to\your-service-account-key.json"
```

**Option B: Application Default Credentials**

```powershell
gcloud auth application-default login
```

#### 6. Grant Required Permissions

Your service account needs the following permissions:
- `aiplatform.reasoningEngines.create` - To deploy agents
- `aiplatform.sessions.create` - To create sessions
- `aiplatform.reasoningEngines.query` - To query agents

**Grant permissions:**
1. Go to: https://console.cloud.google.com/iam-admin/iam?project=aiagent-capstoneproject
2. Find your service account: `adk-agent-service@aiagent-capstoneproject.iam.gserviceaccount.com`
3. Click **Edit** (pencil icon)
4. Add role: **Vertex AI User** (`roles/aiplatform.user`)
5. Click **Save**
6. Wait 1-2 minutes for propagation

## üì¶ Deployment

### Deploy the Agent

```powershell
cd sample_agent

# Set authentication
$env:GOOGLE_APPLICATION_CREDENTIALS = "aiagent-capstoneproject-10beb4eeaf31.json"

# Deploy using ADK
adk deploy --config .agent_engine_config.json
```

**Note**: The `.agent_engine_config.json` file is auto-generated by ADK during deployment.

### Verify Deployment

After deployment, you'll receive:
- **Resource Name**: `projects/{PROJECT_NUMBER}/locations/{REGION}/reasoningEngines/{ENGINE_ID}`
- **Project Number**: Different from project ID
- **Region**: Deployment region (e.g., `us-central1`)

Update `retrieveAgent.py` with your deployed agent's resource name.

## üîç Querying Deployed Agents

### Method 1: Using retrieveAgent.py

```powershell
cd sample_agent
$env:GOOGLE_APPLICATION_CREDENTIALS = "aiagent-capstoneproject-10beb4eeaf31.json"
python retrieveAgent.py
```

### Method 2: Using ADK API Server

```powershell
cd sample_agent
adk api_server --reasoning-engine=projects/{PROJECT_NUMBER}/locations/{REGION}/reasoningEngines/{ENGINE_ID}
```

Then query via HTTP:
```powershell
Invoke-WebRequest -Uri "http://localhost:8000/agents/weather_assistant/run" `
  -Method POST -ContentType "application/json" `
  -Body '{"message": "What is the weather in Tokyo?"}'
```

### Method 3: Using ADK Web UI

```powershell
cd sample_agent
adk web --reasoning-engine=projects/{PROJECT_NUMBER}/locations/{REGION}/reasoningEngines/{ENGINE_ID}
```

This opens a web interface for interacting with your agent.

## üß™ Local Testing

Test the agent locally before deployment:

```python
from sample_agent.agent import root_agent

# Run the agent locally
response = root_agent.run("What is the weather in Tokyo?")
print(response)
```

## üìù Agent Details

### Current Agent: Weather Assistant

- **Name**: `weather_assistant`
- **Model**: `gemini-2.5-flash-lite`
- **Description**: A helpful weather assistant that provides weather information for cities
- **Tools**: `get_weather(city: str)`

### Supported Cities

- San Francisco
- New York
- London
- Tokyo
- Paris

## üîß Troubleshooting

### Common Issues

#### 1. Permission Denied (403)

**Error**: `Permission 'aiplatform.reasoningEngines.create' denied`

**Solution**: Grant `Vertex AI User` role to your service account (see Setup Step 6).

#### 2. Region Not Available (404)

**Error**: `404 Not Found` for reasoning engines endpoint

**Solution**: Ensure you're using a supported region:
- ‚úÖ `us-central1`
- ‚ùå `us-east2` (not supported)

#### 3. Reserved Environment Variable

**Error**: `Environment variable name 'GOOGLE_APPLICATION_CREDENTIALS' is reserved`

**Solution**: Remove `GOOGLE_APPLICATION_CREDENTIALS` from `.env` file. Set it only in your PowerShell session.

#### 4. Session Creation Failed

**Error**: `Permission 'aiplatform.sessions.create' denied`

**Solution**: Ensure your service account has `roles/aiplatform.user` role.

#### 5. BOM Encoding Error

**Error**: `Unknown value type in env_vars for \ufeff`

**Solution**: Recreate `.env` file without BOM:
```powershell
Set-Content -Encoding utf8NoBOM -Path ".env" -Value "GOOGLE_CLOUD_PROJECT=..."
```

## üìö Resources

- [Google ADK Documentation](https://cloud.google.com/vertex-ai/docs/adk)
- [Vertex AI Agent Engines](https://cloud.google.com/vertex-ai/docs/agent-engines)
- [Google Cloud IAM Roles](https://cloud.google.com/iam/docs/understanding-roles)

## üîê Security Notes

- **Never commit** `.env` files or service account keys
- `.gitignore` protects sensitive files
- Use service accounts with minimal required permissions
- Rotate credentials regularly

## üìÑ License

This project is part of a Kaggle Capstone project.

## üë§ Author

**Naresh Saladi**
- GitHub: [@nareshsaladi2024](https://github.com/nareshsaladi2024)
- Repository: [AIAgents-Kaggle-Capstone](https://github.com/nareshsaladi2024/AIAgents-Kaggle-Capstone)

## ü§ù Contributing

This is a capstone project. Contributions and feedback are welcome!

---

**Last Updated**: January 2025

